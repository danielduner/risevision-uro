var RiseVision=RiseVision||{};RiseVision.Events={};RiseVision.Events.Settings={};RiseVision.Events.EventWidget={};RiseVision.Events.Settings=function(){this.settings=new RiseVision.Common.Settings};
RiseVision.Events.Settings.prototype.initSettings=function(){var a=this;$(".colorPicker").on("click",function(){eventSettings.showColorPicker($(this).data("for"))});$(".fontSelector").on("click",function(){eventSettings.showFontSelector($(this).data("for"))});$("#visualOption").on("change",function(){"tab"==$(this).val()?($("li.tabs").show(),$("li.list").hide()):($("li.tabs").hide(),$("li.list").show())});$("#scrollBy").on("change",function(){"none"==$(this).val()?$("li.scroll").hide():$("li.scroll").show()});
$("#useDefault").on("click",function(){$(this).is(":checked")?$("li.layoutURL").hide():$("li.layoutURL").show()});gadgets.rpc.call("","rscmd_getAdditionalParams",function(b){b&&(b=JSON.parse(b),$("#visualOption").val(prefs.getString("visualOption")),$("#daysCount").val(prefs.getString("daysCount")),$("#scrollBy").val(prefs.getString("scrollBy")),$("#scrollHold").val(prefs.getString("scrollHold")),$("#scrollResumes").val(prefs.getString("scrollResumes")),$("#bgColor").val(prefs.getString("bgColor")),
$("#activeTabBgColor").val(prefs.getString("activeTabBgColor")),$("#activeTabColor").val(prefs.getString("activeTabColor")),$("#inactiveTabBgColor").val(prefs.getString("inactiveTabBgColor")),$("#inactiveTabColor").val(prefs.getString("inactiveTabColor")),$("#showDate").attr("checked",prefs.getBool("showDate")),$("#useDefault").attr("checked",prefs.getBool("useDefault")),a.populateColor($("#bgColor"),prefs.getString("bgColor")),a.populateColor($("#activeTabBgColor"),prefs.getString("activeTabBgColor")),
a.populateColor($("#activeTabColor"),prefs.getString("activeTabColor")),a.populateColor($("#inactiveTabBgColor"),prefs.getString("inactiveTabBgColor")),a.populateColor($("#inactiveTabColor"),prefs.getString("inactiveTabColor")),$("#calendarID").val(b.calendarID),$("#tab_font-style").text(b.tab_font),$("#tab_font-style").data("css",b["tab_font-style"]),$("#day_font-style").text(b.day_font),$("#day_font-style").data("css",b["day_font-style"]),$("#title_font-style").text(b.title_font),$("#title_font-style").data("css",
b["title_font-style"]),$("#location_font-style").text(b.location_font),$("#location_font-style").data("css",b["location_font-style"]),$("#description_font-style").text(b.description_font),$("#description_font-style").data("css",b["description_font-style"]),$("#layoutURL").val(b.layoutURL));$("form ol li ol.drillDown li:visible:last").css({clear:"left","float":"left","margin-bottom":"10px"});$("#visualOption").trigger("change");$("#scrollBy").trigger("change");$("#useDefault").triggerHandler("click");
$("#settings").show()})};RiseVision.Events.Settings.prototype.populateColor=function(a,b){a.val(b);a.css("background-color",b)};RiseVision.Events.Settings.prototype.showColorPicker=function(a){gadgets.rpc.call("","rscmd_openColorPicker",null,a,$("#"+a).val())};RiseVision.Events.Settings.prototype.showFontSelector=function(a){gadgets.rpc.call("","rscmd_openFontSelector",null,a,$("#"+a).data("css"))};
RiseVision.Events.Settings.prototype.setColor=function(a,b){$("#"+a).val(b);$("#"+a).css("background-color",b)};RiseVision.Events.Settings.prototype.setFont=function(a,b,c){$("#"+a).data("css",b);$("#"+a).text(c)};
RiseVision.Events.Settings.prototype.getSettings=function(){var a=!1,b=document.getElementsByClassName("errors")[0],c=null,d=null,e=null,g="";$(".errors").empty();$(".errors").css({display:"none"});if(""!=$("#calendarID").val())c=new google.gdata.calendar.CalendarService(""),d=new google.gdata.calendar.CalendarEventQuery("http://www.google.com/calendar/feeds/"+$("#calendarID").val()+"/public/full"),d.setMaxResults(1),c.getEventsFeed(d,function(){a=eventSettings.settings.validateRequired($("#scrollHold"),
b,"Scroll Hold")?!0:a;a=eventSettings.settings.validateRequired($("#scrollResumes"),b,"Scroll Resumes")?!0:a;a=eventSettings.settings.validateRequired($("#layoutURL"),b,"Layout URL")?!0:a;a=eventSettings.settings.validateNumeric($("#scrollHold"),b,"Scroll Hold")?!0:a;if(a=eventSettings.settings.validateNumeric($("#scrollResumes"),b,"Scroll Resumes")?!0:a)return $(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null;g="up_visualOption="+escape($("#visualOption").val())+
"&up_activeTabBgColor="+$("#activeTabBgColor").val()+"&up_activeTabColor="+$("#activeTabColor").val()+"&up_inactiveTabBgColor="+$("#inactiveTabBgColor").val()+"&up_inactiveTabColor="+$("#inactiveTabColor").val()+"&up_daysCount="+$("#daysCount").val()+"&up_scrollBy="+$("#scrollBy").val()+"&up_scrollHold="+$("#scrollHold").val()+"&up_scrollResumes="+$("#scrollResumes").val()+"&up_bgColor="+$("#bgColor").val();g=$("#showDate").is(":checked")?g+"&up_showDate=true":g+"&up_showDate=false";g=$("#useDefault").is(":checked")?
g+"&up_useDefault=true":g+"&up_useDefault=false";e={params:g,additionalParams:JSON.stringify(eventSettings.saveAdditionalParams())};gadgets.rpc.call("","rscmd_saveSettings",null,e)},function(){$(".errors").append("The calendar could not be read. Please ensure that the Calendar ID is correct and that the calendar is public.");$(".errors").fadeIn(200).css("display","inline-block");$("#wrapper").scrollTop(0);return null});else if(a=eventSettings.settings.validateRequired($("#calendarID"),b,"Calendar ID")?
!0:a)return $(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null};
RiseVision.Events.Settings.prototype.saveAdditionalParams=function(){var a={};a.calendarID=$("#calendarID").val();a.tab_font=$("#tab_font-style").text();a["tab_font-style"]=$("#tab_font-style").data("css");a.day_font=$("#day_font-style").text();a["day_font-style"]=$("#day_font-style").data("css");a.title_font=$("#title_font-style").text();a["title_font-style"]=$("#title_font-style").data("css");a.location_font=$("#location_font-style").text();a["location_font-style"]=$("#location_font-style").data("css");
a.description_font=$("#description_font-style").text();a["description_font-style"]=$("#description_font-style").data("css");a.layoutURL=$("#layoutURL").val();return a};
RiseVision.Events.EventWidget=function(){var a=new gadgets.Prefs;this.visualOption=a.getString("visualOption");this.isTabbed="tab"==this.visualOption?!0:!1;this.daysCount=a.getInt("daysCount");this.scrollBy=a.getString("scrollBy");this.scrollHold=1E3*a.getInt("scrollHold");this.scrollResumes=1E3*a.getInt("scrollResumes");this.showDate=a.getBool("showDate");this.isPaused=this.isLoading=!0;this.interactivityTimerID=this.scrollTimerID=this.layout=this.service=null;this.eventsCount=0;this.isScrolling=
null;this.isDown=!1;this.lastY=0;0>=this.daysCount?this.daysCount=1:7<this.daysCount&&(this.daysCount=7);this.isTabbed&&(this.tabs=null)};
RiseVision.Events.EventWidget.prototype.getAdditionalParams=function(a,b){if("additionalParams"==a&&b){var c=document.createElement("style");b=JSON.parse(b);eventWidget.url="http://www.google.com/calendar/feeds/"+b.calendarID+"/public/full";eventWidget.layoutURL=prefs.getBool("useDefault")?eventWidget.isTabbed?"https://s3.amazonaws.com/Gadget-Events/Layouts/Tabs/Tabs.xml":"https://s3.amazonaws.com/Gadget-Events/Layouts/List/List.xml":b.layoutURL;b["tab_font-style"]&&c.appendChild(document.createTextNode(b["tab_font-style"]));
b["day_font-style"]&&c.appendChild(document.createTextNode(b["day_font-style"]));b["title_font-style"]&&c.appendChild(document.createTextNode(b["title_font-style"]));b["location_font-style"]&&c.appendChild(document.createTextNode(b["location_font-style"]));b["description_font-style"]&&c.appendChild(document.createTextNode(b["description_font-style"]));document.getElementsByTagName("head")[0].appendChild(c)}eventWidget.init()};
RiseVision.Events.EventWidget.prototype.init=function(){var a=this,b={};b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM;gadgets.io.makeRequest(this.layoutURL,function(b){b=b.data;0<b.getElementsByTagName("Navigation").length&&(a.navigation=b.getElementsByTagName("Navigation")[0].childNodes[1].nodeValue);if(0<b.getElementsByTagName("Style").length){var d=document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css";e.innerHTML=b.getElementsByTagName("Style")[0].childNodes[1].nodeValue;
d.appendChild(e)}0==b.getElementsByTagName("Content").length?console.log("No Content tag specified in custom layout file."):(a.layout=b.getElementsByTagName("Content")[0].childNodes[1].nodeValue,a.isTabbed?RiseVision.Common.Utility.loadJS("https://s3.amazonaws.com/Gadget-Events/Layouts/Tabs/Tabs.js",function(){$("#container").append(a.navigation);a.tabs=new Tabs;a.tabs.initTabs(a.daysCount);a.getCalendar()}):($("#container").append(a.navigation),a.initDays(),a.getCalendar()))},b)};
RiseVision.Events.EventWidget.prototype.initDays=function(){for(var a=0,b=Date.today();a<this.daysCount;a++){var c=$(".day").eq(a);c.empty();0==a?c.text("Today"):c.text(b.toString("dddd"));b.setDate(b.getDate()+1)}for(a=6;a>=this.daysCount;a--)$(".content > ul > li").eq(a).remove()};RiseVision.Events.EventWidget.prototype.setupService=function(){this.service=new google.gdata.calendar.CalendarService("")};
RiseVision.Events.EventWidget.prototype.getCalendar=function(){var a=new google.gdata.calendar.CalendarEventQuery(this.url),b=Date.today(),c=Date.today().set({hour:23,minute:59,second:59}),d=this;c.add({days:this.daysCount-1});a.setOrderBy("starttime");a.setSortOrder("ascending");a.setMinimumStartTime(new google.gdata.DateTime(b));a.setMaximumStartTime(new google.gdata.DateTime(c));a.setMaxResults(100);a.setSingleEvents(!0);this.isDataLoading=!0;this.setupService();this.service.getEventsFeed(a,function(a){d.showEvents(a);
d.scrollerHeight=$("#scroller").height();d.isLoading?(d.isTabbed&&d.tabs.setScrollContainerTop(),d.configureScrolling()):(d.isTabbed||d.configureScrolling(),d.isPaused||d.setScroll());setTimeout(function(){clearInterval(d.scrollTimerID);d.isTabbed&&(d.tabs.stopTimer(),d.tabs.initTabs(d.daysCount));d.isScrolling=null;d.getCalendar()},3E5);d.isDataLoading=!1;d.isLoading&&(d.isLoading=!1,readyEvent())},function(a){setTimeout(function(){clearInterval(d.scrollTimerID);d.isTabbed&&d.tabs.initTabs(d.daysCount);
d.isScrolling=null;d.getCalendar()},3E5);d.isDataLoading=!1;console.log(a);d.isLoading&&(d.isLoading=!1,readyEvent())})};RiseVision.Events.EventWidget.prototype.configureScrolling=function(){var a=this;this.isTouchDevice()?$(".scrollContainer").bind({touchstart:function(b){a.handleStart(b)},touchmove:function(b){a.handleMove(b)},touchend:function(){a.handleEnd()}}):$(".scrollContainer").bind({mousedown:function(b){a.handleStart(b)},mousemove:function(b){a.handleMove(b)},mouseup:function(){a.handleEnd()}})};
RiseVision.Events.EventWidget.prototype.showEvents=function(a){a=a.feed.entry;Date.today();this.isTabbed?this.tabs.clear():($("#container").empty(),$("#container").append(this.navigation),this.initDays());for(var b=0;b<a.length;b++)for(var c=a[b],d=c.getTitle().getText(),e=c.getLocations(),e=0<e.length?e[0].valueString:"",g=c.getTimes(),f=null,j=0;j<g.length;j++){var h=g[j].getStartTime(),k=!1;h.isDateOnly()&&(k=!0);if(this.isTabbed)f=this.tabs.addEvent(this.layout,h);else{var m=this,l=Date.today();
$(".day").each(function(a){0==l.compareTo(h.getDate().clone().clearTime())&&(f=$(".events").eq(a),f.append(m.layout));l.setDate(l.getDate()+1)})}f&&(f.find(".title:last").html(f.find(".title:last").html()+d),this.showDate&&f.find(".date:last").html(f.find(".date:last").html()+h.getDate().toString("dddd")),k?f.find(".time:last").html(" - All Day"):this.showDate?f.find(".time:last").html(f.find(".time:last").html()+h.getDate().toString("h:mmtt").toLowerCase()):f.find(".time:last").html(h.getDate().toString("h:mmtt").toLowerCase()),
""==e?f.find(".location:last").html(e):f.find(".location:last").html(f.find(".location:last").html()+e),f.find(".description:last").html(c.getContent().getText()))}};RiseVision.Events.EventWidget.prototype.isTouchDevice=function(){return"ontouchstart"in window};RiseVision.Events.EventWidget.prototype.play=function(){this.isPaused&&(this.isPaused=!1,this.isDataLoading||this.setScroll())};RiseVision.Events.EventWidget.prototype.pause=function(){clearInterval(this.scrollTimerID);this.isPaused=!0};
RiseVision.Events.EventWidget.prototype.setScroll=function(){var a=this;"none"!=this.scrollBy&&(this.scrollTimerID=setInterval(function(){"row"==a.scrollBy?a.scrollByRow():a.scrollByPage()},this.scrollHold))};
RiseVision.Events.EventWidget.prototype.scrollByRow=function(){var a=this;if(this.isTabbed)clearInterval(this.scrollTimerID),this.tabs.scrollByRow();else{var b=null,c=$(".eventsContainer:first"),d=c.find(".day"),b=c.find(".events"),e=b.find(".event:first"),g=$("#scroller"),f=parseInt(g.css("margin-top")),j=0;this.scrollerHeight>$("#container").height()&&(j=0<b.find(".event").length?1==b.find(".event").length?c.offset().top+c.outerHeight(!0):e.offset().top+e.outerHeight(!0):0<b.find(".day").length?
d.offset().top+d.outerHeight(!0):c.offset().top+c.outerHeight(!0),0>=this.eventsCount?(this.eventsCount=b.find(".event").length,b=c.clone(),b.find(".event").slice(1).remove(),g.append(b),g.animate({"margin-top":f-j+"px"},"slow",function(){g.css("margin-top","0px");d.remove();e.remove();a.eventsCount--;0>=a.eventsCount&&c.remove()})):(b=e.clone(),g.find(".events:last").append(b),g.animate({"margin-top":f-j+"px"},"slow",function(){g.css("margin-top","0px");e.remove();a.eventsCount--;0==a.eventsCount&&
c.remove()})))}};
RiseVision.Events.EventWidget.prototype.scrollByPage=function(){if(this.isTabbed)clearInterval(this.scrollTimerID),this.tabs.scrollByPage();else{var a=$("#scroller"),b=parseInt(a.css("margin-top")),c=$("#container").height(),d=0;if(null==this.isScrolling)if(this.scrollerHeight>c){var e=a.children().clone();a.append(e);this.isScrolling=!0}else this.isScrolling=!1;this.isScrolling&&a.animate({"margin-top":b-c+"px"},"slow",function(){for(var c=$(".eventsContainer").length-1;0<=c;c--){var f=$(".eventsContainer").eq(c),
e=f.offset().top,h=f.outerHeight(!0);if(0>e+h){e=f.clone();if(0==d)a.append(e);else{var k;k=1==d?a.find(".eventsContainer:last"):a.find(".eventsContainer").slice(-d,-d+1);e.insertBefore(k)}f.remove();b=parseInt(a.css("margin-top"));a.css("margin-top",b+h);d++}}})}};
RiseVision.Events.EventWidget.prototype.handleStart=function(a){clearInterval(this.scrollTimerID);this.isTabbed&&this.tabs.stopTimer();this.isTouchDevice()?1==a.originalEvent.targetTouches.length&&(this.lastY=a.originalEvent.targetTouches[0].clientY):this.lastY=a.clientY;this.isDown=!0};
RiseVision.Events.EventWidget.prototype.handleEnd=function(){var a=this;clearTimeout(this.interactivityTimerID);this.interactivityTimerID=setTimeout(function(){$(".content:visible").stop().animate({"margin-top":"0px"},500,function(){a.setScroll()})},this.scrollResumes);this.isDown=!1};
RiseVision.Events.EventWidget.prototype.handleMove=function(a){var b,c,d;this.isDown&&(this.isTouchDevice()?1==a.originalEvent.targetTouches.length&&(b=a.originalEvent.targetTouches[0],b=b.clientY):b=a.clientY,a=this.lastY-b,c=$(".content:visible"),c.css("margin-top"),d=c.height(),0<a?parseInt(c.css("margin-top"))>-(d-$(".scrollContainer:visible").height())&&c.css("margin-top",parseInt(c.css("margin-top"))-a+"px"):0>a&&(0<parseInt(c.css("margin-top"))-a?c.css("margin-top","0px"):c.css("margin-top",
parseInt(c.css("margin-top"))-a+"px")),this.lastY=b)};